<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>04 Threads & Concurrency | 操作系统原理</title>
    <meta name="description" content="操作系统原理课程笔记">
    <meta name="generator" content="VitePress v1.0.0-rc.33">
    <link rel="preload stylesheet" href="/osp-learning/assets/style.PxKxcv_0.css" as="style">
    
    <script type="module" src="/osp-learning/assets/app.K3DuI-nc.js"></script>
    <link rel="preload" href="/osp-learning/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/osp-learning/assets/chunks/framework.GAJuE5ww.js">
    <link rel="modulepreload" href="/osp-learning/assets/chunks/theme.adVtvu3R.js">
    <link rel="modulepreload" href="/osp-learning/assets/04-threads-and-concurrency.md.hZCrsMgj.lean.js">
    <link rel="icon" type="image/ico" href="/favicon.ico">
    <meta name="theme-color" content="#a8b1ff">
    <meta name="og:type" content="website">
    <meta name="og:locale" content="cn">
    <meta name="og:site_name" content="CWorld Project">
    <meta name="og:image" content="https://osp.cworld.top/computer_desk.png">
    <script>setTimeout(function(){var e=document.createElement("script");e.src="https://busuanzi.icodeq.com/busuanzi.pure.mini.js",document.head.appendChild(e)},2e3);</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c0d0c9b8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-da26bb63></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-da26bb63> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c0d0c9b8 data-v-0b77fffe><div class="VPNavBar has-sidebar" data-v-0b77fffe data-v-16caf00e><div class="container" data-v-16caf00e><div class="title" data-v-16caf00e><div class="VPNavBarTitle has-sidebar" data-v-16caf00e data-v-011085d5><a class="title" href="/osp-learning/" data-v-011085d5><!--[--><!--]--><!--[--><img class="VPImage logo" src="/osp-learning/favicon.ico" width="24" height="24" alt data-v-89bcb906><!--]--><!--[-->操作系统原理<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-16caf00e><div class="curtain" data-v-16caf00e></div><div class="content-body" data-v-16caf00e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-16caf00e><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-16caf00e data-v-4c1aca22><span id="main-nav-aria-label" class="visually-hidden" data-v-4c1aca22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/osp-learning/" tabindex="0" data-v-4c1aca22 data-v-9bcd1aa6><!--[--><span data-v-9bcd1aa6>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/osp-learning/README" tabindex="0" data-v-4c1aca22 data-v-9bcd1aa6><!--[--><span data-v-9bcd1aa6>Intro</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-16caf00e data-v-b2701642><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-b2701642 data-v-72faa351 data-v-fc603f10><span class="check" data-v-fc603f10><span class="icon" data-v-fc603f10><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-72faa351><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-72faa351><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-16caf00e data-v-22842b15 data-v-996ca0eb><!--[--><a class="VPSocialLink no-icon" href="https://cworld.top" aria-label="Blog" target="_blank" rel="noopener" data-v-996ca0eb data-v-58f9f858><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M29.303 32h-26.6A2.686 2.686 0 0 1 0 29.303v-26.6A2.686 2.686 0 0 1 2.697 0h26.704C30.802 0 32 1.197 32 2.697v26.605c0 1.5-1.197 2.697-2.697 2.697zM16 5.303h-4A6.7 6.7 0 0 0 5.303 12v8A6.7 6.7 0 0 0 12 26.697h8A6.7 6.7 0 0 0 26.697 20v-5.303c0-.796-.599-1.395-1.4-1.395H24c-.697 0-1.303-.605-1.303-1.303A6.7 6.7 0 0 0 16 5.296zm4.099 16H12c-.697 0-1.303-.605-1.303-1.303s.605-1.303 1.303-1.303h8.099c.704 0 1.303.6 1.303 1.303s-.599 1.303-1.303 1.303m-3.402-10.606c.704 0 1.303.605 1.303 1.303s-.599 1.303-1.303 1.303h-4.796c-.704 0-1.303-.605-1.303-1.303s.599-1.303 1.303-1.303z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/cworld1/osp-learning" aria-label="github" target="_blank" rel="noopener" data-v-996ca0eb data-v-58f9f858><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-16caf00e data-v-102a837a data-v-5c307bee><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-5c307bee><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-5c307bee><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-5c307bee><div class="VPMenu" data-v-5c307bee data-v-dc2808df><!----><!--[--><!--[--><!----><div class="group" data-v-102a837a><div class="item appearance" data-v-102a837a><p class="label" data-v-102a837a>Appearance</p><div class="appearance-action" data-v-102a837a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-102a837a data-v-72faa351 data-v-fc603f10><span class="check" data-v-fc603f10><span class="icon" data-v-fc603f10><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-72faa351><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-72faa351><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-102a837a><div class="item social-links" data-v-102a837a><div class="VPSocialLinks social-links-list" data-v-102a837a data-v-996ca0eb><!--[--><a class="VPSocialLink no-icon" href="https://cworld.top" aria-label="Blog" target="_blank" rel="noopener" data-v-996ca0eb data-v-58f9f858><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M29.303 32h-26.6A2.686 2.686 0 0 1 0 29.303v-26.6A2.686 2.686 0 0 1 2.697 0h26.704C30.802 0 32 1.197 32 2.697v26.605c0 1.5-1.197 2.697-2.697 2.697zM16 5.303h-4A6.7 6.7 0 0 0 5.303 12v8A6.7 6.7 0 0 0 12 26.697h8A6.7 6.7 0 0 0 26.697 20v-5.303c0-.796-.599-1.395-1.4-1.395H24c-.697 0-1.303-.605-1.303-1.303A6.7 6.7 0 0 0 16 5.296zm4.099 16H12c-.697 0-1.303-.605-1.303-1.303s.605-1.303 1.303-1.303h8.099c.704 0 1.303.6 1.303 1.303s-.599 1.303-1.303 1.303m-3.402-10.606c.704 0 1.303.605 1.303 1.303s-.599 1.303-1.303 1.303h-4.796c-.704 0-1.303-.605-1.303-1.303s.599-1.303 1.303-1.303z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/cworld1/osp-learning" aria-label="github" target="_blank" rel="noopener" data-v-996ca0eb data-v-58f9f858><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-16caf00e data-v-4e96a3f2><span class="container" data-v-4e96a3f2><span class="top" data-v-4e96a3f2></span><span class="middle" data-v-4e96a3f2></span><span class="bottom" data-v-4e96a3f2></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-c0d0c9b8 data-v-102a5e8a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-102a5e8a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-102a5e8a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-102a5e8a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-102a5e8a data-v-e41b686a><button data-v-e41b686a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-c0d0c9b8 data-v-d762a214><div class="curtain" data-v-d762a214></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-d762a214><span class="visually-hidden" id="sidebar-aria-label" data-v-d762a214> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-d762a214><section class="VPSidebarItem level-0" data-v-d762a214 data-v-149ee9e6><div class="item" role="button" tabindex="0" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><h2 class="text" data-v-149ee9e6>Intro</h2><!----></div><div class="items" data-v-149ee9e6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/README" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>Project Intro</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/00-os-principle-intro" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>00 OS Principles Course Intro</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-d762a214><section class="VPSidebarItem level-0 has-active" data-v-d762a214 data-v-149ee9e6><div class="item" role="button" tabindex="0" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><h2 class="text" data-v-149ee9e6>Main</h2><!----></div><div class="items" data-v-149ee9e6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/01-how-computer-work" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>01 How Computer Work</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/02-os-structures" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>02 Operating-System Structures</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/03-processes" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>03 Processes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/04-threads-and-concurrency" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>04 Threads & Concurrency</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/05-cpu-scheduling" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>05 CPU Scheduling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/06-sync-tools" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>06 Synchronization Tools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/07-sync-examples" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>07 Synchronization Examples (合并到 ch6)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/08-deadlocks" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>08 Deadlocks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/09-memory-manage" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>09 Memory Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/10-v-memory" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>10 Virtual Memory</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/11-mass-storage-sys" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>11 Mass-Storage Systems</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/12-io-sys" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>12 I/O System</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/14-file-sys-implement" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>14 File System Implementation</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-d762a214><section class="VPSidebarItem level-0" data-v-d762a214 data-v-149ee9e6><div class="item" role="button" tabindex="0" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><h2 class="text" data-v-149ee9e6>Extra</h2><!----></div><div class="items" data-v-149ee9e6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/ex-critical-res" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>sched_c - scheduling primitives</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/ex-mid-exam" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>什么是临界资源，临界区？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-149ee9e6 data-v-149ee9e6><div class="item" data-v-149ee9e6><div class="indicator" data-v-149ee9e6></div><a class="VPLink link link" href="/osp-learning/ex-sched" data-v-149ee9e6><!--[--><p class="text" data-v-149ee9e6>Mid Exam</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c0d0c9b8 data-v-829ea6de><div class="VPDoc has-sidebar has-aside" data-v-829ea6de data-v-03b98a48><!--[--><!--]--><div class="container" data-v-03b98a48><div class="aside" data-v-03b98a48><div class="aside-curtain" data-v-03b98a48></div><div class="aside-container" data-v-03b98a48><div class="aside-content" data-v-03b98a48><div class="VPDocAside" data-v-03b98a48 data-v-757a858f><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-757a858f data-v-b61dc11a><div class="content" data-v-b61dc11a><div class="outline-marker" data-v-b61dc11a></div><div class="outline-title" role="heading" aria-level="2" data-v-b61dc11a>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-b61dc11a><span class="visually-hidden" id="doc-outline-aria-label" data-v-b61dc11a> Table of Contents for current page </span><ul class="root" data-v-b61dc11a data-v-55f46707><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-757a858f></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-03b98a48><div class="content-container" data-v-03b98a48><!--[--><!--]--><!----><main class="main" data-v-03b98a48><div style="position:relative;" class="vp-doc _osp-learning_04-threads-and-concurrency" data-v-03b98a48><div><h1 id="_04-threads-concurrency" tabindex="-1">04 Threads &amp; Concurrency <a class="header-anchor" href="#_04-threads-concurrency" aria-label="Permalink to &quot;04 Threads &amp; Concurrency&quot;">​</a></h1><h2 id="contents" tabindex="-1">Contents <a class="header-anchor" href="#contents" aria-label="Permalink to &quot;Contents&quot;">​</a></h2><ul><li><p>Overview</p></li><li><p>Multicore Programming</p></li><li><p>Multithreading Models</p></li><li><p>Thread Libraries</p></li><li><p>Implicit Threading</p></li><li><p>Threading Issues</p></li><li><p>Operating System Examples</p></li></ul><h3 id="objectives" tabindex="-1">Objectives <a class="header-anchor" href="#objectives" aria-label="Permalink to &quot;Objectives&quot;">​</a></h3><ul><li><p>To introduce the notion of a thread—a fundamental unit of CPU utilization that forms the basis of multithreaded computer systems</p></li><li><p>To discuss the APIs for the Pthreads, Windows, and Java thread libraries</p></li><li><p>To explore several strategies that provide implicit threading</p></li><li><p>To examine issues related to multithreaded programming</p></li><li><p>To cover operating system support for threads in Windows and Linux</p></li></ul><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li>并发：交替执行（如果是一个核的话）</li><li>并行：多任务同时执行</li></ul><h3 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h3><p>Most modern applications are multithreaded. Threads run within application.</p><p>Multiple tasks with the application can be implemented by separate threads 应用程序的多个任务可由不同的线程执行. As:</p><ul><li><p>Update display</p></li><li><p>Fetch data</p></li><li><p>Spell checking</p></li><li><p>Answer a network request.</p></li></ul><p>Process creation is heavy-weight while thread creation is light-weight 进程创建花费的时间是线程创建的 30 倍</p><p>Can simplify code, increase efficiency 可以简化代码，提高效率</p><p>Kernels are generally multithreaded 内核通常是多线程的</p><p>Benefits:</p><ul><li>Responsiveness 可响应性</li><li>Resource Sharing 资源共享</li><li>Economy 经济</li><li>Scalability 可扩展性</li></ul><h2 id="补充" tabindex="-1">补充 <a class="header-anchor" href="#补充" aria-label="Permalink to &quot;补充&quot;">​</a></h2><p><a href="https://ng-tech.icu/books/linux-notes/01.%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%A4%84%E7%90%86%E5%99%A8/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/02.%E7%94%A8%E6%88%B7%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B/" target="_blank" rel="noreferrer">https://ng-tech.icu/books/linux-notes/01.进程与处理器/进程与线程/02.用户线程与内核线程/</a></p><p>在 Linux 2.4 版以前，线程的实现和管理方式就是完全按照进程方式实现的；在 Linux 2.6 之前，内核并不支持线程的概念，仅通过轻量级进程（Lightweight Process）模拟线程；轻量级进程是建立在内核之上并由内核支持的用户线程，它是内核线程的高度抽象，每一个轻量级进程都与一个特定的内核线程关联。内核线程只能由内核管理并像普通进程一样被调度。这种模型最大的特点是线程调度由内核完成了，而其他线程操作（同步、取消）等都是核外的线程库（Linux Thread）函数完成的。</p><p>为了完全兼容 Posix 标准，Linux 2.6 首先对内核进行了改进，引入了线程组的概念（<strong>仍然用轻量级进程表示线程</strong>），有了这个概念就可以将一组线程组织称为一个进程，不过内核并没有准备特别的调度算法或是定义特别的数据结构来表征线程；相反，线程仅仅被视为一个与其他进程（概念上应该是线程）共享某些资源的进程（概念上应该是线程）。在实现上主要的改变就是在 task_struct 中加入 tgid 字段，这个字段就是用于表示线程组 id 的字段。在用户线程库方面，也使用 NPTL 代替 Linux Thread，不同调度模型上仍然采用 <code>1 对 1</code> 模型。</p><p><img src="/osp-learning/assets/image_DpaeTi88Ue.9rENQcCd.png" alt=""></p><p>进程的实现是调用 fork 系统调用：<code>pid_t fork(void);</code>，线程的实现是调用 clone 系统调用：<code>int clone(int (*fn)(void *), void *child_stack, int flags, void *arg, ...)</code>。与标准 <code>fork()</code> 相比，线程带来的开销非常小，内核无需单独复制进程的内存空间或文件描写叙述符等等。这就节省了大量的 CPU 时间，使得线程创建比新进程创建快上十到一百倍，能够大量使用线程而无需太过于操心带来的 CPU 或内存不足。无论是 fork、vfork、kthread_create 最后都是要调用 do_fork，而 do_fork 就是根据不同的函数参数，对一个进程所需的资源进行分配。</p><h3 id="内核线程" tabindex="-1">内核线程 <a class="header-anchor" href="#内核线程" aria-label="Permalink to &quot;内核线程&quot;">​</a></h3><p>内核线程是由内核自己创建的线程，也叫做守护线程（Deamon），在终端上用命令 <code>ps -Al</code> 列出的所有进程中，名字以 k 开关以 d 结尾的往往都是内核线程，比如 kthreadd、kswapd 等。与用户线程相比，它们都由 <code>do_fork()</code> 创建，每个线程都有独立的 task_struct 和内核栈；也都参与调度，内核线程也有优先级，会被调度器平等地换入换出。二者的不同之处在于，内核线程只工作在内核态中；而用户线程则既可以运行在内核态（执行系统调用时），也可以运行在用户态；内核线程没有用户空间，所以对于一个内核线程来说，它的 0~3G 的内存空间是空白的，它的 <code>current-&gt;mm</code> 是空的，与内核使用同一张页表；而用户线程则可以看到完整的 0~4G 内存空间。</p><p>在 Linux 内核启动的最后阶段，系统会创建两个内核线程，一个是 init，一个是 kthreadd。其中 init 线程的作用是运行文件系统上的一系列”init”脚本，并启动 shell 进程，所以 init 线程称得上是系统中所有用户进程的祖先，它的 pid 是 1。kthreadd 线程是内核的守护线程，在内核正常工作时，它永远不退出，是一个死循环，它的 pid 是 2。</p></div></div></main><footer class="VPDocFooter" data-v-03b98a48 data-v-cf9cbca9><!--[--><!--]--><div class="edit-info" data-v-cf9cbca9><div class="edit-link" data-v-cf9cbca9><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/cworld1/osp-learning/edit/main/docs/04-threads-and-concurrency.md" target="_blank" rel="noreferrer" data-v-cf9cbca9><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-cf9cbca9><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-cf9cbca9><p class="VPLastUpdated" data-v-cf9cbca9 data-v-f475a1fe>Last updated: <time datetime="2024-10-23T14:25:34.000Z" data-v-f475a1fe></time></p></div></div><nav class="prev-next" data-v-cf9cbca9><div class="pager" data-v-cf9cbca9><a class="VPLink link pager-link prev" href="/osp-learning/03-processes" data-v-cf9cbca9><!--[--><span class="desc" data-v-cf9cbca9>Previous page</span><span class="title" data-v-cf9cbca9>03 Processes</span><!--]--></a></div><div class="pager" data-v-cf9cbca9><a class="VPLink link pager-link next" href="/osp-learning/05-cpu-scheduling" data-v-cf9cbca9><!--[--><span class="desc" data-v-cf9cbca9>Next page</span><span class="title" data-v-cf9cbca9>05 CPU Scheduling</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-c0d0c9b8 data-v-e3e4fc8f><div class="container" data-v-e3e4fc8f><p class="message" data-v-e3e4fc8f>Released under the GPL-3 License. (<span id="busuanzi_value_site_pv">???</span> views totally)</p><p class="copyright" data-v-e3e4fc8f>Copyright © 2023-present CWorld</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"14-file-sys-implement.md\":\"wfuDzmOx\",\"01-how-computer-work.md\":\"1_sv5bHE\",\"06-sync-tools.md\":\"PCdUCl2a\",\"11-mass-storage-sys.md\":\"t61KoWas\",\"00-os-principle-intro.md\":\"lZiR1rJl\",\"ex-sched.md\":\"CVNJzmWy\",\"09-memory-manage.md\":\"NZoRSSn8\",\"08-deadlocks.md\":\"nD2zbjPy\",\"10-v-memory.md\":\"fsEkkJ5K\",\"03-processes.md\":\"sfM5on97\",\"ex-critical-res.md\":\"A50BbrSd\",\"12-io-sys.md\":\"GH1zWnR-\",\"ex-mid-exam.md\":\"dY2z65rS\",\"07-sync-examples.md\":\"TbVMm2nL\",\"05-cpu-scheduling.md\":\"Bqg1iQPY\",\"readme.md\":\"Q2UF4Koh\",\"04-threads-and-concurrency.md\":\"hZCrsMgj\",\"index.md\":\"_GiKZSw6\",\"02-os-structures.md\":\"daWUH6yp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"操作系统原理\",\"description\":\"操作系统原理课程笔记\",\"base\":\"/osp-learning/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":{\"src\":\"/favicon.ico\",\"width\":24,\"height\":24},\"outline\":[2,3],\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Intro\",\"link\":\"/README\"}],\"sidebar\":[{\"text\":\"Intro\",\"items\":[{\"text\":\"Project Intro\",\"link\":\"/README\"},{\"text\":\"00 OS Principles Course Intro\",\"link\":\"/00-os-principle-intro\"}]},{\"text\":\"Main\",\"items\":[{\"text\":\"01 How Computer Work\",\"link\":\"/01-how-computer-work\"},{\"text\":\"02 Operating-System Structures\",\"link\":\"/02-os-structures\"},{\"text\":\"03 Processes\",\"link\":\"/03-processes\"},{\"text\":\"04 Threads & Concurrency\",\"link\":\"/04-threads-and-concurrency\"},{\"text\":\"05 CPU Scheduling\",\"link\":\"/05-cpu-scheduling\"},{\"text\":\"06 Synchronization Tools\",\"link\":\"/06-sync-tools\"},{\"text\":\"07 Synchronization Examples (合并到 ch6)\",\"link\":\"/07-sync-examples\"},{\"text\":\"08 Deadlocks\",\"link\":\"/08-deadlocks\"},{\"text\":\"09 Memory Management\",\"link\":\"/09-memory-manage\"},{\"text\":\"10 Virtual Memory\",\"link\":\"/10-v-memory\"},{\"text\":\"11 Mass-Storage Systems\",\"link\":\"/11-mass-storage-sys\"},{\"text\":\"12 I/O System\",\"link\":\"/12-io-sys\"},{\"text\":\"14 File System Implementation\",\"link\":\"/14-file-sys-implement\"}]},{\"text\":\"Extra\",\"items\":[{\"text\":\"sched_c - scheduling primitives\",\"link\":\"/ex-critical-res\"},{\"text\":\"什么是临界资源，临界区？\",\"link\":\"/ex-mid-exam\"},{\"text\":\"Mid Exam\",\"link\":\"/ex-sched\"}]}],\"socialLinks\":[{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"32\\\" height=\\\"32\\\" viewBox=\\\"0 0 32 32\\\"><path fill=\\\"currentColor\\\" d=\\\"M29.303 32h-26.6A2.686 2.686 0 0 1 0 29.303v-26.6A2.686 2.686 0 0 1 2.697 0h26.704C30.802 0 32 1.197 32 2.697v26.605c0 1.5-1.197 2.697-2.697 2.697zM16 5.303h-4A6.7 6.7 0 0 0 5.303 12v8A6.7 6.7 0 0 0 12 26.697h8A6.7 6.7 0 0 0 26.697 20v-5.303c0-.796-.599-1.395-1.4-1.395H24c-.697 0-1.303-.605-1.303-1.303A6.7 6.7 0 0 0 16 5.296zm4.099 16H12c-.697 0-1.303-.605-1.303-1.303s.605-1.303 1.303-1.303h8.099c.704 0 1.303.6 1.303 1.303s-.599 1.303-1.303 1.303m-3.402-10.606c.704 0 1.303.605 1.303 1.303s-.599 1.303-1.303 1.303h-4.796c-.704 0-1.303-.605-1.303-1.303s.599-1.303 1.303-1.303z\\\"/></svg>\"},\"link\":\"https://cworld.top\",\"ariaLabel\":\"Blog\"},{\"icon\":\"github\",\"link\":\"https://github.com/cworld1/osp-learning\"}],\"footer\":{\"message\":\"Released under the GPL-3 License. (<span id=\\\"busuanzi_value_site_pv\\\">???</span> views totally)\",\"copyright\":\"Copyright © 2023-present CWorld\"},\"editLink\":{\"pattern\":\"https://github.com/cworld1/osp-learning/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>